<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAM Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1a1c29 0%, #2d3561 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: rgba(248, 250, 252, 0.9);
            padding: 0;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .tab-buttons {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 18px 30px;
            font-size: 1rem;
            font-weight: 600;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            color: #374151;
            background: rgba(102, 126, 234, 0.05);
        }

        .tab-button.active {
            color: #667eea !important;
            border-bottom-color: #667eea !important;
            background: rgba(102, 126, 234, 0.1) !important;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.5);
            margin-bottom: 20px;
        }

        .card__header {
            padding: 20px 30px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .card__body {
            padding: 30px;
        }

        /* Filters Section */
        .filters-section {
            padding: 30px;
            background: rgba(248, 250, 252, 0.8);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 18px;
            align-items: stretch;
            margin-bottom: 24px;
        }

        .filter-card {
            min-width: 0;
            box-sizing: border-box;
        }

        .filter-card h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(209, 213, 219, 0.5);
            border-radius: 12px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        select[multiple] {
            min-height: 120px;
        }

        .employee-inputs {
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
        }

        .employee-inputs input {
            flex: 1 1 0;
            min-width: 0;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            text-align: center;
        }

        .btn--primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn--secondary {
            background: rgba(107, 114, 128, 0.1);
            color: #374151;
            border: 2px solid rgba(107, 114, 128, 0.2);
        }

        .btn--full-width {
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Results Section */
        .results-section {
            padding: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-count {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
        }

        .search-container {
            flex-grow: 1;
            max-width: 400px;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .results-table th,
        .results-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .results-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s ease;
        }

        .results-table th:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
        }

        .results-table tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.05);
        }

        .sort-indicator {
            margin-left: 8px;
            font-size: 0.8rem;
            opacity: 0.5;
        }

        .sort-indicator.asc::after {
            content: '↑';
            opacity: 1;
            color: #667eea;
        }

        .sort-indicator.desc::after {
            content: '↓';
            opacity: 1;
            color: #667eea;
        }

        .status {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status--info {
            background: rgba(59, 130, 246, 0.1);
            color: #1d4ed8;
        }

        .status--success {
            background: rgba(16, 185, 129, 0.1);
            color: #047857;
        }

        .revenue-high {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        .revenue-medium {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        .revenue-low {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        .search-highlight {
            background: rgba(254, 240, 138, 0.8);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6B7280;
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #374151;
        }

        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            font-size: 1.1rem;
            color: #667eea;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        .hidden {
            display: none;
        }

        a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Account Details Styles */
        .account-details-section {
            padding: 30px;
        }

        .company-selector {
            margin-bottom: 30px;
        }

        .company-selector h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .company-dropdown {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 2px solid rgba(209, 213, 219, 0.5);
            border-radius: 12px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .company-dropdown:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .account-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .info-card h4 {
            color: #374151;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.1);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            padding: 8px 0;
        }

        .info-label {
            font-weight: 600;
            color: #6B7280;
            font-size: 0.9rem;
            min-width: 120px;
        }

        .info-value {
            color: #374151;
            font-weight: 500;
            text-align: right;
            flex: 1;
            word-break: break-word;
        }

        .score-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            min-width: 60px;
        }

        .score-high {
            background: rgba(16, 185, 129, 0.1);
            color: #047857;
        }

        .score-medium {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .score-low {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .notes-section {
            grid-column: 1 / -1;
        }

        .notes-content {
            background: rgba(248, 250, 252, 0.8);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-top: 10px;
        }

        .no-company-selected {
            text-align: center;
            padding: 60px 20px;
            color: #6B7280;
        }

        .no-company-selected h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #374151;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #dc2626;
            margin: 20px;
        }

        .file-upload {
            margin: 20px;
            padding: 20px;
            border: 2px dashed #667eea;
            border-radius: 10px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
        }

        .file-upload input[type="file"] {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .filters-section, 
            .results-section,
            .account-details-section {
                padding: 20px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .results-header {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container {
                max-width: none;
            }

            .results-table th,
            .results-table td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }

            .tab-button {
                padding: 15px 20px;
                font-size: 0.9rem;
            }

            .account-info-grid {
                grid-template-columns: 1fr;
            }

            .info-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .info-label {
                min-width: auto;
            }

            .info-value {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ZoomInfo Account Filter Dashboard</h1>
            <p class="subtitle">Filter and analyze enriched ZoomInfo account data to identify and qualify prospects</p>
        </header>

        <!-- File Upload Section -->
        <div class="file-upload">
            <h3>Upload CSV File</h3>
            <p>Please select your data.csv file to load the dashboard:</p>
            <input type="file" id="csvFileInput" accept=".csv" />
            <div id="uploadStatus"></div>
        </div>

        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <div class="tab-buttons">
                <button class="tab-button active" id="dashboardTab">Dashboard</button>
                <button class="tab-button" id="accountDetailsTab">Account Details</button>
            </div>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <section class="filters-section">
                <div class="filters-grid">
                    <div class="card filter-card">
                        <h3>Revenue Range</h3>
                        <div class="form-group">
                            <select id="revenueFilter" class="form-control" multiple size="6">
                                <option value="Under $500,000">Under $500,000</option>
                                <option value="$500,000 - $1 mil.">$500,000 - $1 mil.</option>
                                <option value="$1 mil. - $5 mil.">$1 mil. - $5 mil.</option>
                                <option value="$5 mil. - $10 mil.">$5 mil. - $10 mil.</option>
                                <option value="$10 mil. - $25 mil.">$10 mil. - $25 mil.</option>
                                <option value="$25 mil. - $50 mil.">$25 mil. - $50 mil.</option>
                                <option value="$50 mil. - $100 mil.">$50 mil. - $100 mil.</option>
                                <option value="$100 mil. - $250 mil.">$100 mil. - $250 mil.</option>
                                <option value="$250 mil. - $500 mil.">$250 mil. - $500 mil.</option>
                                <option value="$500 mil. - $1 bil.">$500 mil. - $1 bil.</option>
                                <option value="Over $5 bil.">Over $5 bil.</option>
                            </select>
                        </div>
                    </div>

                    <div class="card filter-card">
                        <h3>Employee Count</h3>
                        <div class="employee-inputs">
                            <div class="form-group">
                                <label class="form-label" for="minEmployees">Min Employees</label>
                                <input type="number" id="minEmployees" class="form-control" placeholder="0" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="maxEmployees">Max Employees</label>
                                <input type="number" id="maxEmployees" class="form-control" placeholder="Unlimited" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="card filter-card">
                        <h3>Segmentation</h3>
                        <div class="form-group">
                            <select id="segmentationFilter" class="form-control" multiple size="6"></select>
                        </div>
                    </div>

                    <div class="card filter-card">
                        <h3>Assigned To</h3>
                        <div class="form-group">
                            <select id="assignedToFilter" class="form-control" multiple size="6"></select>
                        </div>
                    </div>

                    <div class="card filter-card">
                        <h3>Actions</h3>
                        <div class="action-buttons">
                            <button id="clearFilters" class="btn btn--secondary btn--full-width">Clear Filters</button>
                            <button id="exportData" class="btn btn--primary btn--full-width">Export Data</button>
                        </div>
                    </div>
                </div>
            </section>

            <section class="results-section">
                <div class="card">
                    <div class="card__header">
                        <div class="results-header">
                            <h2>Account Results</h2>
                            <div class="results-count"><span id="resultsCount">0 accounts found</span></div>
                        </div>
                        <div class="search-container">
                            <input type="text" id="searchInput" class="form-control" placeholder="Search within results...">
                        </div>
                    </div>
                    <div class="card__body">
                        <div class="table-container">
                            <table id="resultsTable" class="results-table">
                                <thead>
                                    <tr>
                                        <th data-sort="Company Name">Company Name <span class="sort-indicator"></span></th>
                                        <th data-sort="Assigned To">Assigned To <span class="sort-indicator"></span></th>
                                        <th data-sort="Account Type">Account Type <span class="sort-indicator"></span></th>
                                        <th data-sort="Prospect Score">Prospect Score <span class="sort-indicator"></span></th>
                                        <th data-sort="Account Notes">Account Notes <span class="sort-indicator"></span></th>
                                        <th data-sort="Drop Notes">Drop Notes <span class="sort-indicator"></span></th>
                                        <th data-sort="Website">Website <span class="sort-indicator"></span></th>
                                        <th data-sort="LinkedIn URL">LinkedIn <span class="sort-indicator"></span></th>
                                        <th data-sort="Revenue Estimate">Revenue <span class="sort-indicator"></span></th>
                                        <th data-sort="Employees">Employees <span class="sort-indicator"></span></th>
                                        <th data-sort="Head Office">Head Office <span class="sort-indicator"></span></th>
                                        <th data-sort="Country">Country <span class="sort-indicator"></span></th>
                                        <th data-sort="Segmentation">Segmentation <span class="sort-indicator"></span></th>
                                    </tr>
                                </thead>
                                <tbody id="resultsBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Account Details Tab -->
        <div id="account-details-tab" class="tab-content">
            <section class="account-details-section">
                <div class="card">
                    <div class="card__header">
                        <div class="company-selector">
                            <h3>Select Company</h3>
                            <select id="companyDropdown" class="company-dropdown">
                                <option value="">-- Select a company --</option>
                            </select>
                        </div>
                    </div>
                    <div class="card__body">
                        <div id="accountDetailsContent">
                            <div class="no-company-selected">
                                <h3>No Company Selected</h3>
                                <p>Please select a company from the dropdown above to view detailed account information.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div id="loadingIndicator" class="loading hidden">
            <div class="loading-spinner"></div>
            <p>Loading data...</p>
        </div>
    </div>

    <script>
        // Global variables
        let zoomInfoData = [];
        let filteredData = [];
        let currentSortColumn = null;
        let currentSortDirection = 'asc';

        // Password check and initialization
        const correctPassword = "flames";
        
        function checkPassword() {
            const enteredPassword = prompt("This dashboard is protected. Please enter the password:");
            if (enteredPassword === correctPassword) {
                document.body.style.display = 'block';
                return true;
            } else if (enteredPassword !== null) {
                alert("Incorrect password. Please try again.");
                return checkPassword();
            } else {
                document.body.style.display = 'none';
                return false;
            }
        }

        // Simple CSV parser (no external dependencies)
        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',');
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] ? values[index].trim().replace(/"/g, '') : '';
                    });
                    data.push(row);
                }
            }
            
            return data;
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, checking password...');
            
            if (!checkPassword()) {
                return;
            }

            setupFileUpload();
            setupTabs();
            console.log('App initialized successfully');
        });

        function setupFileUpload() {
            const fileInput = document.getElementById('csvFileInput');
            const uploadStatus = document.getElementById('uploadStatus');
            
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file && file.type === 'text/csv') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            uploadStatus.innerHTML = '<p style="color: blue;">Processing CSV...</p>';
                            zoomInfoData = parseCSV(e.target.result);
                            console.log('CSV parsed successfully:', zoomInfoData.length, 'records');
                            uploadStatus.innerHTML = '<p style="color: green;">✓ CSV loaded successfully! ' + zoomInfoData.length + ' records found.</p>';
                            initializeDashboard();
                        } catch (error) {
                            console.error('Error parsing CSV:', error);
                            uploadStatus.innerHTML = '<p style="color: red;">Error parsing CSV: ' + error.message + '</p>';
                        }
                    };
                    reader.readAsText(file);
                } else {
                    uploadStatus.innerHTML = '<p style="color: red;">Please select a valid CSV file.</p>';
                }
            });
        }

        function setupTabs() {
            const dashboardTab = document.getElementById('dashboardTab');
            const accountDetailsTab = document.getElementById('accountDetailsTab');
            
            dashboardTab.addEventListener('click', function() {
                console.log('Dashboard tab clicked');
                switchToTab('dashboard');
            });
            
            accountDetailsTab.addEventListener('click', function() {
                console.log('Account Details tab clicked');
                switchToTab('account-details');
            });
        }

        function switchToTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab content
            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
                console.log('Tab content shown:', tabName);
            } else {
                console.error('Tab content not found:', tabName + '-tab');
            }

            // Add active class to correct tab button
            if (tabName === 'dashboard') {
                document.getElementById('dashboardTab').classList.add('active');
            } else if (tabName === 'account-details') {
                document.getElementById('accountDetailsTab').classList.add('active');
            }
        }

        function initializeDashboard() {
            try {
                populateSegmentationFilter();
                populateAssignedToFilter();
                populateCompanyDropdown();
                attachEventListeners();
                filteredData = [...zoomInfoData];
                renderTable();
                console.log('Dashboard initialized successfully');
            } catch (error) {
                console.error('Error initializing dashboard:', error);
            }
        }

        function attachEventListeners() {
            // Filter event listeners
            const revenueFilter = document.getElementById('revenueFilter');
            const segmentationFilter = document.getElementById('segmentationFilter');
            const assignedToFilter = document.getElementById('assignedToFilter');
            const minEmployeesInput = document.getElementById('minEmployees');
            const maxEmployeesInput = document.getElementById('maxEmployees');
            const searchInput = document.getElementById('searchInput');
            const clearFiltersBtn = document.getElementById('clearFilters');
            const exportDataBtn = document.getElementById('exportData');
            const companyDropdown = document.getElementById('companyDropdown');

            if (revenueFilter) revenueFilter.addEventListener('change', handleFilterChange);
            if (segmentationFilter) segmentationFilter.addEventListener('change', handleFilterChange);
            if (assignedToFilter) assignedToFilter.addEventListener('change', handleFilterChange);
            if (minEmployeesInput) minEmployeesInput.addEventListener('input', debounce(handleFilterChange, 300));
            if (maxEmployeesInput) maxEmployeesInput.addEventListener('input', debounce(handleFilterChange, 300));
            if (searchInput) searchInput.addEventListener('input', debounce(handleFilterChange, 300));
            if (clearFiltersBtn) clearFiltersBtn.addEventListener('click', clearAllFilters);
            if (exportDataBtn) exportDataBtn.addEventListener('click', exportToCSV);
            if (companyDropdown) companyDropdown.addEventListener('change', handleCompanySelection);
            
            // Sortable headers
            document.querySelectorAll('[data-sort]').forEach(header => {
                header.addEventListener('click', () => sortTable(header.dataset.sort));
            });
        }

        function handleFilterChange() {
            setTimeout(() => {
                try {
                    applyAllFilters();
                } catch (error) {
                    console.error('Error in handleFilterChange:', error);
                }
            }, 50);
        }

        function applyAllFilters() {
            let data = [...zoomInfoData];
            
            // Revenue filter
            const revenueFilter = document.getElementById('revenueFilter');
            if (revenueFilter) {
                const selectedRevenues = getSelectedOptions(revenueFilter);
                if (selectedRevenues.length > 0) {
                    data = data.filter(item => selectedRevenues.includes(item['Revenue Estimate']));
                }
            }

            // Employee count filter
            const minEmployees = parseInt(document.getElementById('minEmployees')?.value) || 0;
            const maxEmployees = parseInt(document.getElementById('maxEmployees')?.value) || Number.MAX_SAFE_INTEGER;
            data = data.filter(item => {
                const empCount = parseInt(item['Employees']) || 0;
                return empCount >= minEmployees && empCount <= maxEmployees;
            });

            // Segmentation filter
            const segmentationFilter = document.getElementById('segmentationFilter');
            if (segmentationFilter) {
                const selectedSegments = getSelectedOptions(segmentationFilter);
                if (selectedSegments.length > 0) {
                    data = data.filter(item => selectedSegments.includes(item['Segmentation']));
                }
            }

            // Assigned To filter
            const assignedToFilter = document.getElementById('assignedToFilter');
            if (assignedToFilter) {
                const selectedAssignedTos = getSelectedOptions(assignedToFilter);
                if (selectedAssignedTos.length > 0) {
                    data = data.filter(item => selectedAssignedTos.includes(item['Assigned To']));
                }
            }

            // Search filter
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput?.value?.trim().toLowerCase() || '';
            if (searchTerm) {
                data = data.filter(item => {
                    return Object.values(item).some(value =>
                        String(value).toLowerCase().includes(searchTerm)
                    );
                });
            }

            filteredData = data;
            if (currentSortColumn) applySorting();
            renderTable();
        }

        function getSelectedOptions(selectElement) {
            if (!selectElement) return [];
            return Array.from(selectElement.selectedOptions).map(option => option.value);
        }

        function clearAllFilters() {
            try {
                const revenueFilter = document.getElementById('revenueFilter');
                const segmentationFilter = document.getElementById('segmentationFilter');
                const assignedToFilter = document.getElementById('assignedToFilter');
                const minEmployees = document.getElementById('minEmployees');
                const maxEmployees = document.getElementById('maxEmployees');
                const searchInput = document.getElementById('searchInput');

                if (revenueFilter) revenueFilter.selectedIndex = -1;
                if (segmentationFilter) segmentationFilter.selectedIndex = -1;
                if (assignedToFilter) assignedToFilter.selectedIndex = -1;
                if (minEmployees) minEmployees.value = '';
                if (maxEmployees) maxEmployees.value = '';
                if (searchInput) searchInput.value = '';

                currentSortColumn = null;
                currentSortDirection = 'asc';
                updateSortIndicators();
                filteredData = [...zoomInfoData];
                renderTable();
            } catch (error) {
                console.error('Error clearing filters:', error);
            }
        }

        function sortTable(column) {
            try {
                if (currentSortColumn === column) {
                    currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSortColumn = column;
                    currentSortDirection = 'asc';
                }
                applySorting();
                renderTable();
                updateSortIndicators();
            } catch (error) {
                console.error('Error sorting table:', error);
            }
        }

        function applySorting() {
            filteredData.sort((a, b) => {
                let aVal, bVal;
                if (currentSortColumn === 'Employees') {
                    aVal = parseInt(a['Employees']) || 0;
                    bVal = parseInt(b['Employees']) || 0;
                } else if (currentSortColumn === 'Prospect Score') {
                    aVal = parseFloat(a['Prospect Score']) || 0;
                    bVal = parseFloat(b['Prospect Score']) || 0;
                } else {
                    aVal = (a[currentSortColumn] || '').toLowerCase();
                    bVal = (b[currentSortColumn] || '').toLowerCase();
                }
                if (aVal < bVal) return currentSortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSortDirection === 'asc' ? 1 : -1;
                return 0;
            });
        }

        function updateSortIndicators() {
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.className = 'sort-indicator';
            });
            if (currentSortColumn) {
                const indicator = document.querySelector(`[data-sort="${currentSortColumn}"] .sort-indicator`);
                if (indicator) indicator.classList.add(currentSortDirection);
            }
        }

        function renderTable() {
            const resultsBody = document.getElementById('resultsBody');
            if (!resultsBody) return;
            
            resultsBody.innerHTML = '';
            
            if (filteredData.length === 0) {
                resultsBody.innerHTML = `<tr>
                    <td colspan="13" class="no-results">
                        <h3>No accounts found</h3>
                        <p>Try adjusting your filters to see more results.</p>
                    </td>
                </tr>`;
                updateResultsCount(0);
                return;
            }
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                const website = (item['Website'] || '').startsWith('http') ? item['Website'] : `https://${item['Website']}`;
                const linkedinURL = item['LinkedIn URL'] || '#';
                
                row.innerHTML = `
                    <td><strong>${escapeHtml(item['Company Name'])}</strong></td>
                    <td>${escapeHtml(item['Assigned To'] || 'Unassigned')}</td>
                    <td><span class="status status--info">${escapeHtml(item['Account Type'] || 'N/A')}</span></td>
                    <td><span style="${getScoreStyle(item['Prospect Score'])}">${item['Prospect Score'] || 'N/A'}</span></td>
                    <td>${escapeHtml(item['Account Notes'] || '')}</td>
                    <td>${escapeHtml(item['Drop Notes'] || item['DropNotes'] || '')}</td>
                    <td><a href="${website}" target="_blank">${escapeHtml(item['Website'])}</a></td>
                    <td>${linkedinURL !== '#' ? `<a href="${linkedinURL}" target="_blank">LinkedIn</a>` : 'N/A'}</td>
                    <td><span class="${getRevenueClass(item['Revenue Estimate'])}">${escapeHtml(item['Revenue Estimate'])}</span></td>
                    <td>${parseInt(item['Employees'] || 0).toLocaleString()}</td>
                    <td>${escapeHtml(item['Head Office'])}</td>
                    <td>${escapeHtml(item['Country'])}</td>
                    <td><span class="status status--success">${escapeHtml(item['Segmentation'] || 'N/A')}</span></td>
                `;
                resultsBody.appendChild(row);
            });
            
            updateResultsCount(filteredData.length);
            highlightSearchTerms();
        }

        function getScoreStyle(score) {
            let num = parseFloat(score);
            if (isNaN(num)) num = 0;
            let normalized = Math.max(0, Math.min(100, num)) / 100;
            let hue = 0 + 120 * normalized;
            let saturation = 38;
            let lightness = 91;
            let textColor = '#1a1a1a';
            return `background-color: hsl(${hue},${saturation}%,${lightness}%); color: ${textColor}; font-weight: bold; font-size: 1.05em; padding:6px 10px; border-radius: 6px; min-width: 38px; display: inline-block; text-align: center; letter-spacing: 0.5px;`;
        }

        function getRevenueClass(revenue) {
            if (!revenue) return '';
            if (revenue.includes('bil.') || revenue.includes('$500 mil. - $1 bil.') || revenue.includes('$250 mil. - $500 mil.') || revenue.includes('$100 mil. - $250 mil.')) {
                return 'revenue-high';
            } else if (revenue.includes('$50 mil.') || revenue.includes('$25 mil.')) {
                return 'revenue-medium';
            }
            return 'revenue-low';
        }

        function exportToCSV() {
            try {
                if (filteredData.length === 0) {
                    alert('No data to export. Please adjust your filters.');
                    return;
                }
                
                const headers = [
                    'Company Name', 'Assigned To', 'Account Type', 'Prospect Score', 'Account Notes',
                    'Drop Notes', 'Website', 'LinkedIn URL', 'Revenue Estimate', 'Employees',
                    'Head Office', 'Country', 'Segmentation'
                ];
                
                const csvRows = [
                    headers.join(','),
                    ...filteredData.map(item => headers.map(header => {
                        const field = item[header] || '';
                        return `"${String(field).replace(/"/g, '""')}"`;
                    }).join(','))
                ];
                
                const csvContent = csvRows.join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `zoominfo_accounts_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Error exporting CSV:', error);
                alert('Error exporting data. Please try again.');
            }
        }

        function updateResultsCount(count) {
            const resultsCount = document.getElementById('resultsCount');
            if (resultsCount) {
                const total = zoomInfoData.length;
                resultsCount.textContent = `${count.toLocaleString()} of ${total.toLocaleString()} accounts found`;
            }
        }

        function highlightSearchTerms() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.trim().toLowerCase();
            if (!searchTerm) return;
            
            const regex = new RegExp(escapeRegex(searchTerm), 'gi');
            const resultsBody = document.getElementById('resultsBody');
            if (resultsBody) {
                resultsBody.querySelectorAll('td').forEach(cell => {
                    if (cell.querySelector('a')) return;
                    const text = cell.textContent;
                    if (regex.test(text)) {
                        cell.innerHTML = text.replace(regex, match =>
                            `<span class="search-highlight">${match}</span>`
                        );
                    }
                });
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
            };
            return String(text || '').replace(/[&<>"']/g, m => map[m]);
        }

        function escapeRegex(string) {
            return String(string || '').replace(/[.*+?^${}()|[\]\\]/g, '\\        function attachEventListeners() {
            // Filter event listeners
            const revenueFilter = document.getElementById('revenue');
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function populateSegmentationFilter() {
            const segmentationFilter = document.getElementById('segmentationFilter');
            if (!segmentationFilter) return;
            
            try {
                const uniqueSegments = [
                    ...new Set(
                        zoomInfoData
                            .map(item => item['Segmentation'] || '')
                            .filter(seg => seg)
                    )
                ].sort();
                
                segmentationFilter.innerHTML = '';
                uniqueSegments.forEach(seg => {
                    const option = document.createElement('option');
                    option.value = seg;
                    option.textContent = seg;
                    segmentationFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Error populating segmentation filter:', error);
            }
        }

        function populateAssignedToFilter() {
            const assignedToFilter = document.getElementById('assignedToFilter');
            if (!assignedToFilter) return;
            
            try {
                const uniqueAssigned = [
                    ...new Set(
                        zoomInfoData
                            .map(item => item['Assigned To'] || '')
                            .filter(name => name)
                    )
                ].sort();
                
                assignedToFilter.innerHTML = '';
                uniqueAssigned.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    assignedToFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Error populating assigned to filter:', error);
            }
        }

        function populateCompanyDropdown() {
            const companyDropdown = document.getElementById('companyDropdown');
            if (!companyDropdown) return;
            
            try {
                const uniqueCompanies = [
                    ...new Set(
                        zoomInfoData
                            .map(item => item['Company Name'] || '')
                            .filter(name => name)
                    )
                ].sort();
                
                companyDropdown.innerHTML = '<option value="">-- Select a company --</option>';
                uniqueCompanies.forEach(company => {
                    const option = document.createElement('option');
                    option.value = company;
                    option.textContent = company;
                    companyDropdown.appendChild(option);
                });
                
                console.log('Company dropdown populated with', uniqueCompanies.length, 'companies');
            } catch (error) {
                console.error('Error populating company dropdown:', error);
            }
        }

        function handleCompanySelection() {
            const companyDropdown = document.getElementById('companyDropdown');
            const accountDetailsContent = document.getElementById('accountDetailsContent');
            
            if (!companyDropdown || !accountDetailsContent) return;
            
            try {
                const selectedCompany = companyDropdown.value;
                console.log('Company selected:', selectedCompany);
                
                if (!selectedCompany) {
                    accountDetailsContent.innerHTML = `
                        <div class="no-company-selected">
                            <h3>No Company Selected</h3>
                            <p>Please select a company from the dropdown above to view detailed account information.</p>
                        </div>
                    `;
                    return;
                }

                const companyData = zoomInfoData.find(item => item['Company Name'] === selectedCompany);
                if (!companyData) {
                    accountDetailsContent.innerHTML = `
                        <div class="no-company-selected">
                            <h3>Company Not Found</h3>
                            <p>The selected company could not be found in the database.</p>
                        </div>
                    `;
                    return;
                }

                renderAccountDetails(companyData);
            } catch (error) {
                console.error('Error handling company selection:', error);
            }
        }

        function renderAccountDetails(data) {
            const accountDetailsContent = document.getElementById('accountDetailsContent');
            if (!accountDetailsContent) return;
            
            try {
                const activityScore = parseInt(data['Activity']) || 0;
                const generationScore = parseInt(data['Generation']) || 0;
                
                accountDetailsContent.innerHTML = `
                    <div class="account-info-grid">
                        <div class="info-card">
                            <h4>Company Information</h4>
                            <div class="info-item">
                                <span class="info-label">Company Name:</span>
                                <span class="info-value"><strong>${escapeHtml(data['Company Name'])}</strong></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Salesforce ID:</span>
                                <span class="info-value">${escapeHtml(data['SalesforceID'] || 'N/A')}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Location:</span>
                                <span class="info-value">${escapeHtml(data['Location'] || 'N/A')}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Head Office:</span>
                                <span class="info-value">${escapeHtml(data['Head Office'] || 'N/A')}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Country:</span>
                                <span class="info-value">${escapeHtml(data['Country'] || 'N/A')}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Website:</span>
                                <span class="info-value">
                                    ${data['Website'] ? `<a href="${data['Website'].startsWith('http') ? data['Website'] : 'https://' + data['Website']}" target="_blank">${escapeHtml(data['Website'])}</a>` : 'N/A'}
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">LinkedIn:</span>
                                <span class="info-value">
                                    ${data['LinkedIn URL'] ? `<a href="${data['LinkedIn URL']}" target="_blank">View Profile</a>` : 'N/A'}
                                </span>
                            </div>
                        </div>

                        <div class="info-card">
                            <h4>Performance Scores</h4>
                            <div class="info-item">
                                <span class="info-label">Activity Score:</span>
                                <span class="info-value">
                                    <span class="score-badge ${getScoreClass(activityScore)}">${activityScore}/10</span>
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Generation Score:</span>
                                <span class="info-value">
                                    <span class="score-badge ${getScoreClass(generationScore)}">${generationScore}/10</span>
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Prospect Score:</span>
                                <span class="info-value">
                                    <span style="${getScoreStyle(data['Prospect Score'])}">${data['Prospect Score'] || 'N/A'}</span>
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Account Type:</span>
                                <span class="info-value">
                                    <span class="status status--info">${escapeHtml(data['Account Type'] || 'N/A')}</span>
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Segmentation:</span>
                                <span class="info-value">
                                    <span class="status status--success">${escapeHtml(data['Segmentation'] || 'N/A')}</span>
                                </span>
                            </div>
                        </div>

                        <div class="info-card notes-section">
                            <h4>Account Notes</h4>
                            <div class="notes-content">
                                ${escapeHtml(data['Account Notes'] || 'No account notes available.')}
                            </div>
                        </div>

                        <div class="info-card notes-section">
                            <h4>Drop Notes</h4>
                            <div class="notes-content">
                                ${escapeHtml(data['Drop Notes'] || data['DropNotes'] || 'No drop notes available.')}
                            </div>
                        </div>

                        <div class="info-card notes-section">
                            <h4>Interests</h4>
                            <div class="notes-content">
                                ${escapeHtml(data['Interests'] || 'No interests information available.')}
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error rendering account details:', error);
            }
        }

        function getScoreClass(score) {
            if (score >= 8) return 'score-high';
            if (score >= 5) return 'score-medium';
            return 'score-low';
        }
    </script>
</body>
</html>